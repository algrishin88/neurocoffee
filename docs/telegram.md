# Настройка Telegram-бота

Этот документ описывает минимальные шаги для включения Telegram-уведомлений на сайте.

1) Создайте бота через @BotFather и получите `TELEGRAM_BOT_TOKEN`.

2) Определите `TELEGRAM_CHAT_ID` — куда бот будет отправлять сообщения (чат с оператором или канал).
   - Самый простой способ: добавьте бота в нужный чат и отправьте любое сообщение; затем используйте @getidsbot или вызов `getUpdates` API, чтобы увидеть chat_id.

3) Откройте корень проекта и создайте `.env` на основе `.env.example`:

```bash
cp .env.example .env
# затем откройте .env в редакторе и заполните значения
```

4) Переменные, которые нужно задать в `.env`:

- `TELEGRAM_BOT_TOKEN` — токен бота
- `TELEGRAM_CHAT_ID` — основной чат для уведомлений
- `TELEGRAM_SUPPORT_CHAT_ID` — (опционально) чат для сообщений поддержки

5) Примеры для Windows PowerShell (временно для текущей сессии):

```powershell
$env:TELEGRAM_BOT_TOKEN = '123456:ABC-DEF...'
$env:TELEGRAM_CHAT_ID = '987654321'
# Затем запустите сервер в этой же сессии
npm run dev
```

Чтобы сохранить переменную навсегда в профиле пользователя (cmd/PowerShell), используйте `setx`:

```powershell
setx TELEGRAM_BOT_TOKEN "ваш_токен"
setx TELEGRAM_CHAT_ID "ваш_chat_id"
# После setx нужно перезапустить терминал/сервис
```

6) Перезапустите сервер:

```bash
npm run dev    # разработка (nodemon)
npm start      # продакшен
```

7) Проверка работы:

- Сгенерируйте рецепт через интерфейс (Меню → Генерация нейро-рецепта). Сервер отправляет рецепт в Telegram асинхронно.
- В разделе поддержки отправьте запрос оператора — он должен прийти в телеграм.

Если уведомления не приходят, проверьте логи сервера — `lib/telegram.js` логирует ошибки и предупреждения при отсутствии конфигурации.
