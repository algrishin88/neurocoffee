# –ù–µ–π—Ä–æ–ö–æ—Ñ–µ–π–Ω—è - Backend API

Backend —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ù–µ–π—Ä–æ–ö–æ—Ñ–µ–π–Ω–∏ –Ω–∞ Node.js —Å **SQLite** (Prisma ORM).

> ‚ö° **SQLite** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ë–î, —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏!

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# Database (SQLite - —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏!)
DATABASE_URL="file:./dev.db"

# Server
PORT=3000

# JWT Secret (–∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É!)
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# YandexGPT API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ—Ñ–µ)
YANDEX_API_KEY=your-yandex-api-key
YANDEX_FOLDER_ID=your-folder-id

# Environment
NODE_ENV=development
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```bash
npm run init-db
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç SQLite –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (`dev.db`)
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ –ó–∞–ø–æ–ª–Ω–∏—Ç –º–µ–Ω—é —Ç–æ–≤–∞—Ä–∞–º–∏

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

#### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π):
```bash
npm run dev
```

#### –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º:
```bash
npm start
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: `http://localhost:3000`

## üìã API Endpoints

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `POST /api/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/auth/login` - –í—Ö–æ–¥
- `GET /api/auth/me` - –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

### –ö–æ—Ä–∑–∏–Ω–∞
- `GET /api/cart` - –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- `POST /api/cart/add` - –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- `PUT /api/cart/update/:itemId/:size` - –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- `DELETE /api/cart/remove/:itemId/:size` - –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- `DELETE /api/cart/clear` - –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

### –ó–∞–∫–∞–∑—ã
- `POST /api/orders` - –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) - **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î**
- `GET /api/orders` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- `GET /api/orders/:id` - –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ ID (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ñ–µ (AI)
- `POST /api/ai/generate-coffee` - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ü–µ–ø—Ç –∫–æ—Ñ–µ —á–µ—Ä–µ–∑ YandexGPT (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

### –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `POST /api/bookings` - –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–∏–∫–∞
- `GET /api/bookings/my` - –ü–æ–ª—É—á–∏—Ç—å –º–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

### –ö–æ–Ω—Ç–∞–∫—Ç—ã
- `POST /api/contacts` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

### –ú–µ–Ω—é
- `GET /api/menu` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –º–µ–Ω—é
- `GET /api/menu/:id` - –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### SQLite (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

- **–ù–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- –§–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: `dev.db` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –¢–∞–±–ª–∏—Ü—ã:

- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `carts` - –∫–æ—Ä–∑–∏–Ω—ã
- `cart_items` - —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ
- `orders` - –∑–∞–∫–∞–∑—ã (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏)
- `order_items` - —Ç–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ
- `bookings` - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `contacts` - —Å–æ–æ–±—â–µ–Ω–∏—è
- `menu_items` - —Ç–æ–≤–∞—Ä—ã –º–µ–Ω—é
- `menu_item_sizes` - —Ä–∞–∑–º–µ—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤

### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö

```bash
# Prisma Studio (–≤–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä)
npm run prisma:studio
```

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client
npm run prisma:generate

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npm run prisma:migrate

# –û—Ç–∫—Ä—ã—Ç—å Prisma Studio
npm run prisma:studio

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î –∏ –º–µ–Ω—é
npm run init-db
```

## üîÑ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ PostgreSQL –∏–ª–∏ MySQL

### 1. –ò–∑–º–µ–Ω–∏—Ç–µ `prisma/schema.prisma`:

```prisma
datasource db {
  provider = "postgresql"  // –∏–ª–∏ "mysql"
  url      = env("DATABASE_URL")
}
```

### 2. –û–±–Ω–æ–≤–∏—Ç–µ `.env`:

```env
# PostgreSQL
DATABASE_URL="postgresql://user:password@localhost:5432/neirocafe?schema=public"

# –ò–ª–∏ MySQL
DATABASE_URL="mysql://user:password@localhost:3306/neirocafe"
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
npm run prisma:migrate
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
neirocafe/
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma       # –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SQL)
‚îÇ   ‚îî‚îÄ‚îÄ migrations/         # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ prisma.js          # Prisma Client
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îî‚îÄ‚îÄ auth.js            # Middleware –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ auth.js            # –ú–∞—Ä—à—Ä—É—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ cart.js            # –ú–∞—Ä—à—Ä—É—Ç—ã –∫–æ—Ä–∑–∏–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ orders.js          # –ú–∞—Ä—à—Ä—É—Ç—ã –∑–∞–∫–∞–∑–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ bookings.js        # –ú–∞—Ä—à—Ä—É—Ç—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ contacts.js        # –ú–∞—Ä—à—Ä—É—Ç—ã –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ menu.js            # –ú–∞—Ä—à—Ä—É—Ç—ã –º–µ–Ω—é
‚îÇ   ‚îî‚îÄ‚îÄ ai.js              # –ú–∞—Ä—à—Ä—É—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ—Ñ–µ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ initMenu.js        # –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ–Ω—é
‚îú‚îÄ‚îÄ server.js              # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ package.json           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ dev.db                 # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îî‚îÄ‚îÄ .env                   # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** - JWT —Ç–æ–∫–µ–Ω—ã, —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
2. **–ö–æ—Ä–∑–∏–Ω–∞** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å SQL –ë–î
3. **–ó–∞–∫–∞–∑—ã** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ SQL —Ç–∞–±–ª–∏—Ü—É `orders` –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ñ–µ** - —á–µ—Ä–µ–∑ YandexGPT API
5. **–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–∏–∫–æ–≤** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
6. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ë–î

## üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - —ç—Ç–æ –æ–¥–∏–Ω —Ñ–∞–π–ª `dev.db`. –ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ!

```bash
# –°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é
cp dev.db dev.db.backup

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
cp dev.db.backup dev.db
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "Can't reach database server"

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `.env` —É–∫–∞–∑–∞–Ω–æ:
```env
DATABASE_URL="file:./dev.db"
```

### –û—à–∏–±–∫–∞: "Migration failed"

```bash
# –£–¥–∞–ª–∏—Ç–µ –±–∞–∑—É –∏ —Å–æ–∑–¥–∞–π—Ç–µ –∑–∞–Ω–æ–≤–æ
rm dev.db
npm run init-db
```

### –û—à–∏–±–∫–∞: "Schema validation error"

```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ Prisma Client
npm run prisma:generate
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `QUICK_START_SQL.md` - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- `SQL_SETUP.md` - –ü–æ–¥—Ä–æ–±–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ SQL
- `YANDEX_API_SETUP.md` - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ YandexGPT API

## –õ–∏—Ü–µ–Ω–∑–∏—è

ISC
